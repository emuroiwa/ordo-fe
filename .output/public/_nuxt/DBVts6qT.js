import{r as k,N as h,J as v}from"./B0BgVZwo.js";import{u as b}from"./BdfSQn7-.js";const I=()=>{const l=k([]),c=k(null),r=k(!1),s=k(null),d=v(),u=async(n,t={})=>{const o=b("auth-token"),e={Accept:"application/json",...t.headers};o.value&&(e.Authorization=`Bearer ${o.value}`);let a=globalThis.$fetch;if(!a)try{a=h().$fetch}catch(i){throw console.error("Unable to access $fetch:",i),new Error("$fetch is not available")}return await a(n,{...t,baseURL:d.public.apiBase,headers:e})};return{bookings:l,currentBooking:c,loading:r,error:s,fetchBookings:async(n={})=>{var t;r.value=!0,s.value=null;try{const o=await u("/api/v1/bookings",{method:"GET",query:n});return l.value=o.data||[],o}catch(o){throw s.value=((t=o.data)==null?void 0:t.message)||o.message||"Failed to fetch bookings",console.error("Error fetching bookings:",o),o}finally{r.value=!1}},fetchBooking:async n=>{var t;r.value=!0,s.value=null;try{let o;try{o=await u(`/api/v1/bookings/${n}`,{method:"GET"})}catch(e){if(e.status===401||e.status===403)o=await u(`/api/v1/bookings/${n}/public`,{method:"GET"});else throw e}return c.value=o.booking,o.booking}catch(o){throw s.value=((t=o.data)==null?void 0:t.message)||o.message||"Failed to fetch booking",console.error("Error fetching booking:",o),o}finally{r.value=!1}},createBooking:async n=>{var t;r.value=!0,s.value=null;try{const o=await u("/api/v1/bookings",{method:"POST",body:n,headers:{"Content-Type":"application/json"}});return o.booking&&l.value.unshift(o.booking),o}catch(o){throw s.value=((t=o.data)==null?void 0:t.message)||o.message||"Failed to create booking",console.error("Error creating booking:",o),o}finally{r.value=!1}},updateBooking:async(n,t)=>{var o,e;r.value=!0,s.value=null;try{const a=await u(`/api/v1/bookings/${n}`,{method:"PUT",body:t,headers:{"Content-Type":"application/json"}}),i=l.value.findIndex(g=>g.id===n);return i!==-1&&a.booking&&(l.value[i]=a.booking),((o=c.value)==null?void 0:o.id)===n&&a.booking&&(c.value=a.booking),a}catch(a){throw s.value=((e=a.data)==null?void 0:e.message)||a.message||"Failed to update booking",console.error("Error updating booking:",a),a}finally{r.value=!1}},cancelBooking:async(n,t)=>{var o,e;r.value=!0,s.value=null;try{const a=await u(`/api/v1/bookings/${n}/cancel`,{method:"POST",body:{reason:t},headers:{"Content-Type":"application/json"}}),i=l.value.findIndex(g=>g.id===n);return i!==-1&&a.booking&&(l.value[i]=a.booking),((o=c.value)==null?void 0:o.id)===n&&a.booking&&(c.value=a.booking),a}catch(a){throw s.value=((e=a.data)==null?void 0:e.message)||a.message||"Failed to cancel booking",console.error("Error cancelling booking:",a),a}finally{r.value=!1}},confirmBooking:async n=>{var t,o;r.value=!0,s.value=null;try{const e=await u(`/api/v1/bookings/${n}/confirm`,{method:"POST"}),a=l.value.findIndex(i=>i.id===n);return a!==-1&&e.booking&&(l.value[a]=e.booking),((t=c.value)==null?void 0:t.id)===n&&e.booking&&(c.value=e.booking),e}catch(e){throw s.value=((o=e.data)==null?void 0:o.message)||e.message||"Failed to confirm booking",console.error("Error confirming booking:",e),e}finally{r.value=!1}},markInProgress:async n=>{var t,o;r.value=!0,s.value=null;try{const e=await u(`/api/v1/bookings/${n}/in-progress`,{method:"POST"}),a=l.value.findIndex(i=>i.id===n);return a!==-1&&e.booking&&(l.value[a]=e.booking),((t=c.value)==null?void 0:t.id)===n&&e.booking&&(c.value=e.booking),e}catch(e){throw s.value=((o=e.data)==null?void 0:o.message)||e.message||"Failed to update booking status",console.error("Error marking booking in progress:",e),e}finally{r.value=!1}},completeBooking:async n=>{var t,o;r.value=!0,s.value=null;try{const e=await u(`/api/v1/bookings/${n}/complete`,{method:"POST"}),a=l.value.findIndex(i=>i.id===n);return a!==-1&&e.booking&&(l.value[a]=e.booking),((t=c.value)==null?void 0:t.id)===n&&e.booking&&(c.value=e.booking),e}catch(e){throw s.value=((o=e.data)==null?void 0:o.message)||e.message||"Failed to complete booking",console.error("Error completing booking:",e),e}finally{r.value=!1}},rescheduleBooking:async(n,t)=>{var o,e;r.value=!0,s.value=null;try{const a=await u(`/api/v1/bookings/${n}/reschedule`,{method:"POST",body:{scheduled_at:t},headers:{"Content-Type":"application/json"}}),i=l.value.findIndex(g=>g.id===n);return i!==-1&&a.booking&&(l.value[i]=a.booking),((o=c.value)==null?void 0:o.id)===n&&a.booking&&(c.value=a.booking),a}catch(a){throw s.value=((e=a.data)==null?void 0:e.message)||a.message||"Failed to reschedule booking",console.error("Error rescheduling booking:",a),a}finally{r.value=!1}},getBookingStatus:n=>({color:{pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",in_progress:"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"}[n.status]||"bg-gray-100 text-gray-800",text:n.status.charAt(0).toUpperCase()+n.status.slice(1).replace("_"," ")}),formatBookingTime:n=>{const t=new Date(n);return{date:t.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),time:t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}},canCancelBooking:n=>{if(n.status==="cancelled"||n.status==="completed")return!1;const t=new Date;return(new Date(n.scheduled_at).getTime()-t.getTime())/(1e3*60*60)>0},canRescheduleBooking:n=>{if(n.status!=="pending"&&n.status!=="confirmed")return!1;const t=new Date;return(new Date(n.scheduled_at).getTime()-t.getTime())/(1e3*60*60)>24}}};export{I as u};
