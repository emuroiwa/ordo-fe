import{K as E,r as v,j as c}from"./Pug_bBfL.js";const O=()=>{const{$fetch:n}=E(),a=v(null),d=v(null),s=v(!1),f=v(!1),l=v(null),m=async()=>{var r;s.value=!0,l.value=null;try{return a.value=await n("/api/v1/profile"),a.value}catch(e){throw l.value=((r=e.data)==null?void 0:r.message)||"Failed to fetch profile",e}finally{s.value=!1}},p=async r=>{var e;s.value=!0,l.value=null;try{const t=new FormData;Object.entries(r).forEach(([u,i])=>{i!=null&&(Array.isArray(i)?i.forEach((j,D)=>{t.append(`${u}[${D}]`,j)}):t.append(u,String(i)))});const o=await n("/api/v1/profile",{method:"PUT",body:t});return a.value=o.user,o}catch(t){throw l.value=((e=t.data)==null?void 0:e.message)||"Failed to update profile",t}finally{s.value=!1}},h=async r=>{var e;s.value=!0,l.value=null;try{return await n("/api/v1/profile/password",{method:"PUT",body:r})}catch(t){throw l.value=((e=t.data)==null?void 0:e.message)||"Failed to update password",t}finally{s.value=!1}},y=async r=>{var e;f.value=!0,l.value=null;try{const t=new FormData;t.append("avatar",r);const o=await n("/api/v1/profile/avatar",{method:"POST",body:t});return a.value&&(a.value.avatar_url=o.avatar_url),o}catch(t){throw l.value=((e=t.data)==null?void 0:e.message)||"Failed to upload avatar",t}finally{f.value=!1}},w=async()=>{var r;s.value=!0,l.value=null;try{const e=await n("/api/v1/profile/avatar",{method:"DELETE"});return a.value&&(a.value.avatar_url=e.avatar_url,a.value.avatar=void 0),e}catch(e){throw l.value=((r=e.data)==null?void 0:r.message)||"Failed to delete avatar",e}finally{s.value=!1}},g=async()=>{var r;try{return d.value=await n("/api/v1/profile/stats"),d.value}catch(e){throw l.value=((r=e.data)==null?void 0:r.message)||"Failed to fetch profile stats",e}},F=async r=>{if(!a.value)return;const e=a.value.roles||["customer"];let t;return r==="vendor"?t=e.includes("vendor")?e:[...e,"vendor"]:(t=e.filter(o=>o!=="vendor"),t.includes("customer")||t.push("customer")),await p({roles:t})},_=c(()=>{if(!a.value)return!1;const r=["name","email"],e=a.value.is_vendor?["business_name","service_category"]:[];return[...r,...e].every(o=>{const u=a.value[o];return u!=null&&u!==""})}),b=c(()=>{if(!a.value)return 0;const r={name:!!a.value.name,email:!!a.value.email,phone:!!a.value.phone,business_name:!!a.value.business_name,service_category:!!a.value.service_category,avatar:!!a.value.avatar},e=Object.values(r).filter(Boolean).length,t=Object.keys(r).length;return Math.round(e/t*100)}),P=c(()=>a.value?a.value.business_name||a.value.name:""),A=c(()=>{var r;return(r=a.value)!=null&&r.name?a.value.name.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2):"U"});return{user:a,stats:d,loading:s,uploading:f,error:l,isProfileComplete:_,profileCompletion:b,displayName:P,userInitials:A,fetchProfile:m,updateProfile:p,updatePassword:h,uploadAvatar:y,deleteAvatar:w,fetchStats:g,toggleRole:F}};export{O as u};
