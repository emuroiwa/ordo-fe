var D=t=>{throw TypeError(t)};var F=(t,n,r)=>n.has(t)||D("Cannot "+r);var $=(t,n,r)=>(F(t,n,"read from private field"),r?r.call(t):n.get(t)),R=(t,n,r)=>n.has(t)?D("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,r);import{ak as _,r as b,al as C,J as x,am as M,an as H,S as J,j as V,a7 as j,H as S}from"./B83YThMf.js";function I(t){return typeof t=="string"?`'${t}'`:new q().serialize(t)}const q=function(){var n;class t{constructor(){R(this,n,new Map)}compare(e,i){const o=typeof e,a=typeof i;return o==="string"&&a==="string"?e.localeCompare(i):o==="number"&&a==="number"?e-i:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(i,!0))}serialize(e,i){if(e===null)return"null";switch(typeof e){case"string":return i?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const i=Object.prototype.toString.call(e);if(i!=="[object Object]")return this.serializeBuiltInType(i.length<10?`unknown:${i}`:i.slice(8,-1),e);const o=e.constructor,a=o===Object||o===void 0?"":o.name;if(a!==""&&globalThis[a]===o)return this.serializeBuiltInType(a,e);if(typeof e.toJSON=="function"){const c=e.toJSON();return a+(c!==null&&typeof c=="object"?this.$object(c):`(${this.serialize(c)})`)}return this.serializeObjectEntries(a,Object.entries(e))}serializeBuiltInType(e,i){const o=this["$"+e];if(o)return o.call(this,i);if(typeof(i==null?void 0:i.entries)=="function")return this.serializeObjectEntries(e,i.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,i){const o=Array.from(i).sort((c,l)=>this.compare(c[0],l[0]));let a=`${e}{`;for(let c=0;c<o.length;c++){const[l,p]=o[c];a+=`${this.serialize(l,!0)}:${this.serialize(p)}`,c<o.length-1&&(a+=",")}return a+"}"}$object(e){let i=$(this,n).get(e);return i===void 0&&($(this,n).set(e,`#${$(this,n).size}`),i=this.serializeObject(e),$(this,n).set(e,i)),i}$function(e){const i=Function.prototype.toString.call(e);return i.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${i.replace(/\s*\n\s*/g,"")}`}$Array(e){let i="[";for(let o=0;o<e.length;o++)i+=this.serialize(e[o]),o<e.length-1&&(i+=",");return i+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((i,o)=>this.compare(i,o)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}n=new WeakMap;for(const r of["Error","RegExp","URL"])t.prototype["$"+r]=function(e){return`${r}(${e})`};for(const r of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+r]=function(e){return`${r}[${e.join(",")}]`};for(const r of["BigInt64Array","BigUint64Array"])t.prototype["$"+r]=function(e){return`${r}[${e.join("n,")}${e.length>0?"n":""}]`};return t}();function X(t,n){return t===n||I(t)===I(n)}function Y(t,n){if(typeof t!="string")throw new TypeError("argument str must be a string");const r={},e=n||{},i=e.decode||G;let o=0;for(;o<t.length;){const a=t.indexOf("=",o);if(a===-1)break;let c=t.indexOf(";",o);if(c===-1)c=t.length;else if(c<a){o=t.lastIndexOf(";",a-1)+1;continue}const l=t.slice(o,a).trim();if(e!=null&&e.filter&&!(e!=null&&e.filter(l))){o=c+1;continue}if(r[l]===void 0){let p=t.slice(a+1,c).trim();p.codePointAt(0)===34&&(p=p.slice(1,-1)),r[l]=K(p,i)}o=c+1}return r}function G(t){return t.includes("%")?decodeURIComponent(t):t}function K(t,n){try{return n(t)}catch{return t}}const O=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function L(t,n,r){const e=r||{},i=e.encode||encodeURIComponent;if(typeof i!="function")throw new TypeError("option encode is invalid");if(!O.test(t))throw new TypeError("argument name is invalid");const o=i(n);if(o&&!O.test(o))throw new TypeError("argument val is invalid");let a=t+"="+o;if(e.maxAge!==void 0&&e.maxAge!==null){const c=e.maxAge-0;if(Number.isNaN(c)||!Number.isFinite(c))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(c)}if(e.domain){if(!O.test(e.domain))throw new TypeError("option domain is invalid");a+="; Domain="+e.domain}if(e.path){if(!O.test(e.path))throw new TypeError("option path is invalid");a+="; Path="+e.path}if(e.expires){if(!Q(e.expires)||Number.isNaN(e.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+e.expires.toUTCString()}if(e.httpOnly&&(a+="; HttpOnly"),e.secure&&(a+="; Secure"),e.priority)switch(typeof e.priority=="string"?e.priority.toLowerCase():e.priority){case"low":{a+="; Priority=Low";break}case"medium":{a+="; Priority=Medium";break}case"high":{a+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(e.sameSite)switch(typeof e.sameSite=="string"?e.sameSite.toLowerCase():e.sameSite){case!0:{a+="; SameSite=Strict";break}case"lax":{a+="; SameSite=Lax";break}case"strict":{a+="; SameSite=Strict";break}case"none":{a+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return e.partitioned&&(a+="; Partitioned"),a}function Q(t){return Object.prototype.toString.call(t)==="[object Date]"||t instanceof Date}function y(t){if(typeof t!="object")return t;var n,r,e=Object.prototype.toString.call(t);if(e==="[object Object]"){if(t.constructor!==Object&&typeof t.constructor=="function"){r=new t.constructor;for(n in t)t.hasOwnProperty(n)&&r[n]!==t[n]&&(r[n]=y(t[n]))}else{r={};for(n in t)n==="__proto__"?Object.defineProperty(r,n,{value:y(t[n]),configurable:!0,enumerable:!0,writable:!0}):r[n]=y(t[n])}return r}if(e==="[object Array]"){for(n=t.length,r=Array(n);n--;)r[n]=y(t[n]);return r}return e==="[object Set]"?(r=new Set,t.forEach(function(i){r.add(y(i))}),r):e==="[object Map]"?(r=new Map,t.forEach(function(i,o){r.set(y(o),y(i))}),r):e==="[object Date]"?new Date(+t):e==="[object RegExp]"?(r=new RegExp(t.source,t.flags),r.lastIndex=t.lastIndex,r):e==="[object DataView]"?new t.constructor(y(t.buffer)):e==="[object ArrayBuffer]"?t.slice(0):e.slice(-6)==="Array]"?new t.constructor(t):t}const Z={path:"/",watch:!0,decode:t=>_(decodeURIComponent(t)),encode:t=>encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},E=window.cookieStore;function U(t,n){var p;const r={...Z,...n};r.filter??(r.filter=s=>s===t);const e=B(r)||{};let i;r.maxAge!==void 0?i=r.maxAge*1e3:r.expires&&(i=r.expires.getTime()-Date.now());const o=i!==void 0&&i<=0,a=o||e[t]===void 0||e[t]===null,c=y(o?void 0:e[t]??((p=r.default)==null?void 0:p.call(r))),l=i&&!o?te(c,i,r.watch&&r.watch!=="shallow"):b(c);{let s=null;try{!E&&typeof BroadcastChannel<"u"&&(s=new BroadcastChannel(`nuxt:cookies:${t}`))}catch{}const f=(v=!1)=>{!v&&(r.readonly||X(l.value,e[t]))||(ee(t,l.value,r),e[t]=y(l.value),s==null||s.postMessage({value:r.encode(l.value)}))},h=v=>{var A;const k=v.refresh?(A=B(r))==null?void 0:A[t]:r.decode(v.value);u=!0,l.value=k,e[t]=y(k),J(()=>{u=!1})};let u=!1;const z=!!M();if(z&&C(()=>{u=!0,f(),s==null||s.close()}),E){const v=k=>{const A=k.changed.find(T=>T.name===t),N=k.deleted.find(T=>T.name===t);A&&h({value:A.value}),N&&h({value:null})};E.addEventListener("change",v),z&&C(()=>E.removeEventListener("change",v))}else s&&(s.onmessage=({data:v})=>h(v));r.watch&&x(l,()=>{u||f()},{deep:r.watch!=="shallow"}),a&&f(a)}return l}function B(t={}){return Y(document.cookie,t)}function W(t,n,r={}){return n==null?L(t,n,{...r,maxAge:-1}):L(t,n,r)}function ee(t,n,r={}){document.cookie=W(t,n,r)}const P=2147483647;function te(t,n,r){let e,i,o=0;const a=r?b(t):{value:t};return M()&&C(()=>{i==null||i(),clearTimeout(e)}),H((c,l)=>{r&&(i=x(a,l));function p(){o=0,clearTimeout(e);const s=n-o,f=s<P?s:P;e=setTimeout(()=>{if(o+=f,o<n)return p();a.value=void 0,l()},f)}return{get(){return c(),a.value},set(s){p(),a.value=s,l()}}})}const m=b(null),d=b(null),g=b(!1),w=b(Date.now()),ie=()=>{const t=U("auth-token",{default:()=>null,maxAge:2592e3,secure:!0,sameSite:"strict",httpOnly:!1}),n=U("auth-user",{default:()=>null,maxAge:60*60*24*30,secure:!0,sameSite:"strict",httpOnly:!1});t.value&&(d.value=t.value),n.value&&(m.value=n.value);const r=V(()=>!!d.value&&!!m.value),e=async s=>{var f;try{g.value=!0;const h=S(),u=await $fetch("/api/v1/login",{method:"POST",baseURL:h.public.apiBase,body:s,headers:{Accept:"application/json","Content-Type":"application/json"}});return u.token&&u.user?(d.value=u.token,m.value=u.user,t.value=u.token,n.value=u.user,w.value=Date.now(),{success:!0,user:u.user,token:u.token}):{success:!1,error:"Invalid response format"}}catch(h){return console.error("Login error:",h),{success:!1,error:((f=h.data)==null?void 0:f.message)||"Login failed. Please check your credentials."}}finally{g.value=!1}},i=async s=>{var f;try{g.value=!0;const h=S(),u=await $fetch("/api/v1/register",{method:"POST",baseURL:h.public.apiBase,body:s,headers:{Accept:"application/json","Content-Type":"application/json"}});return u.token&&u.user?(d.value=u.token,m.value=u.user,t.value=u.token,n.value=u.user,w.value=Date.now(),{success:!0,user:u.user,token:u.token}):{success:!1,error:"Invalid response format"}}catch(h){return console.error("Registration error:",h),{success:!1,error:((f=h.data)==null?void 0:f.message)||"Registration failed. Please try again."}}finally{g.value=!1}},o=async()=>{try{g.value=!0;const s=S();d.value&&await $fetch("/api/v1/logout",{method:"POST",baseURL:s.public.apiBase,headers:{Authorization:`Bearer ${d.value}`,Accept:"application/json"}})}catch(s){console.error("Logout error:",s)}finally{d.value=null,m.value=null,t.value=null,n.value=null,g.value=!1}},a=async()=>{try{g.value=!0;const s=S();if(!d.value)return null;const f=await $fetch("/api/v1/user",{baseURL:s.public.apiBase,headers:{Authorization:`Bearer ${d.value}`,Accept:"application/json"}});return m.value=f,n.value=f,w.value=Date.now(),f}catch(s){return console.error("Fetch user error:",s),await o(),null}finally{g.value=!1}},c=()=>{w.value=Date.now()},l=()=>{if(!d.value)return!0;const s=24*60*60*1e3;return Date.now()-w.value>s},p=async()=>{try{if(!d.value)return!1;const s=S(),f=await $fetch("/api/v1/refresh",{method:"POST",baseURL:s.public.apiBase,headers:{Authorization:`Bearer ${d.value}`,Accept:"application/json"}});return f.token?(d.value=f.token,t.value=f.token,w.value=Date.now(),!0):!1}catch(s){return console.error("Token refresh error:",s),await o(),!1}};return{user:j(m),token:j(d),isLoading:j(g),lastActivity:j(w),isAuthenticated:r,login:e,register:i,logout:o,fetchUser:a,updateLastActivity:c,isTokenExpired:l,refreshToken:p}};export{ie as u};
