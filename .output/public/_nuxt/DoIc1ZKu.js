import{r as f,j as b,I as v,J as i}from"./B0BgVZwo.js";import{u as h}from"./BdfSQn7-.js";const n=f(null),r=f(null),o=f(!1),u=f(Date.now()),j=()=>{const l=h("auth-token",{default:()=>null,maxAge:2592e3,secure:!0,sameSite:"strict",httpOnly:!1}),c=h("auth-user",{default:()=>null,maxAge:60*60*24*30,secure:!0,sameSite:"strict",httpOnly:!1});l.value&&(r.value=l.value),c.value&&(n.value=c.value);const d=b(()=>!!r.value&&!!n.value),y=async e=>{var t;try{o.value=!0;const s=i(),a=await $fetch("/api/v1/login",{method:"POST",baseURL:s.public.apiBase,body:e,headers:{Accept:"application/json","Content-Type":"application/json"}});return a.token&&a.user?(r.value=a.token,n.value=a.user,l.value=a.token,c.value=a.user,u.value=Date.now(),{success:!0,user:a.user,token:a.token}):{success:!1,error:"Invalid response format"}}catch(s){return console.error("Login error:",s),{success:!1,error:((t=s.data)==null?void 0:t.message)||"Login failed. Please check your credentials."}}finally{o.value=!1}},g=async e=>{var t;try{o.value=!0;const s=i(),a=await $fetch("/api/v1/register",{method:"POST",baseURL:s.public.apiBase,body:e,headers:{Accept:"application/json","Content-Type":"application/json"}});return a.token&&a.user?(r.value=a.token,n.value=a.user,l.value=a.token,c.value=a.user,u.value=Date.now(),{success:!0,user:a.user,token:a.token}):{success:!1,error:"Invalid response format"}}catch(s){return console.error("Registration error:",s),{success:!1,error:((t=s.data)==null?void 0:t.message)||"Registration failed. Please try again."}}finally{o.value=!1}},p=async()=>{try{o.value=!0;const e=i();r.value&&await $fetch("/api/v1/logout",{method:"POST",baseURL:e.public.apiBase,headers:{Authorization:`Bearer ${r.value}`,Accept:"application/json"}})}catch(e){console.error("Logout error:",e)}finally{r.value=null,n.value=null,l.value=null,c.value=null,o.value=!1}},k=async()=>{try{o.value=!0;const e=i();if(!r.value)return null;const t=await $fetch("/api/v1/user",{baseURL:e.public.apiBase,headers:{Authorization:`Bearer ${r.value}`,Accept:"application/json"}});return n.value=t.user,c.value=t.user,u.value=Date.now(),t.user}catch(e){return console.error("Fetch user error:",e),await p(),null}finally{o.value=!1}},m=()=>{u.value=Date.now()},A=()=>{if(!r.value)return!0;const e=24*60*60*1e3;return Date.now()-u.value>e},w=async()=>{try{if(!r.value)return!1;const e=i(),t=await $fetch("/api/v1/refresh",{method:"POST",baseURL:e.public.apiBase,headers:{Authorization:`Bearer ${r.value}`,Accept:"application/json"}});return t.token?(r.value=t.token,l.value=t.token,u.value=Date.now(),!0):!1}catch(e){return console.error("Token refresh error:",e),await p(),!1}};return{user:v(n),token:v(r),isLoading:v(o),lastActivity:v(u),isAuthenticated:d,login:y,register:g,logout:p,fetchUser:k,updateLastActivity:m,isTokenExpired:A,refreshToken:w}};export{j as u};
