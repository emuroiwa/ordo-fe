import{j as m,l as H,I as p,r as v,J as j}from"./B0BgVZwo.js";import{u as q}from"./DoIc1ZKu.js";import{s as J}from"./x_rD_Ya3.js";const r=v([]),n=v(0),g=v(!1),f=v(!1),G=()=>{const s=j(),{token:o}=q(),c=()=>({Authorization:`Bearer ${o.value}`,Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}),w=async(e={})=>{if(!o.value)return{notifications:[],meta:{}};g.value=!0;try{const t=new URLSearchParams({page:(e.page||1).toString(),per_page:(e.perPage||15).toString(),...e.unreadOnly&&{unread_only:"true"},...e.type&&{type:e.type},...e.priority&&{priority:e.priority}}),a=await $fetch(`/api/v1/notifications?${t}`,{baseURL:s.public.apiBase,headers:c(),timeout:1e4});return e.append?r.value=[...r.value,...a.notifications]:r.value=a.notifications,n.value=a.meta.unread_count,a}catch(t){return console.error("Failed to fetch notifications:",t),{notifications:[],meta:{}}}finally{g.value=!1}},y=async(e=5)=>{if(!o.value)return[];try{const t=await $fetch(`/api/v1/notifications/recent?limit=${e}`,{baseURL:s.public.apiBase,headers:c(),timeout:5e3});return r.value=t.notifications,n.value=t.unread_count,t.notifications}catch(t){return console.error("Failed to fetch recent notifications:",t),[]}},b=async()=>{if(!o.value)return 0;try{const e=await $fetch("/api/v1/notifications/unread-count",{baseURL:s.public.apiBase,headers:c(),timeout:5e3});return n.value=e.unread_count,e.unread_count}catch(e){return console.error("Failed to fetch unread count:",e),0}},R=async e=>{if(!o.value)return!1;try{await $fetch(`/api/v1/notifications/${e}/read`,{method:"PATCH",baseURL:s.public.apiBase,headers:c(),timeout:5e3});const t=r.value.find(a=>a.id===e);return t&&!t.read_at&&(t.read_at=new Date().toISOString(),n.value=Math.max(0,n.value-1)),!0}catch(t){return console.error("Failed to mark notification as read:",t),!1}},$=async e=>{if(!o.value)return!1;try{await $fetch(`/api/v1/notifications/${e}/unread`,{method:"PATCH",baseURL:s.public.apiBase,headers:c(),timeout:5e3});const t=r.value.find(a=>a.id===e);return t&&t.read_at&&(t.read_at=null,n.value+=1),!0}catch(t){return console.error("Failed to mark notification as unread:",t),!1}},U=async()=>{if(!o.value)return!1;try{return await $fetch("/api/v1/notifications/mark-all-read",{method:"POST",baseURL:s.public.apiBase,headers:c(),timeout:5e3}),r.value.forEach(e=>{e.read_at||(e.read_at=new Date().toISOString())}),n.value=0,!0}catch(e){return console.error("Failed to mark all notifications as read:",e),!1}},k=async e=>{if(!o.value)return!1;try{await $fetch(`/api/v1/notifications/${e}`,{method:"DELETE",baseURL:s.public.apiBase,headers:c(),timeout:5e3});const t=r.value.findIndex(a=>a.id===e);return t!==-1&&(r.value[t].read_at||(n.value=Math.max(0,n.value-1)),r.value.splice(t,1)),!0}catch(t){return console.error("Failed to delete notification:",t),!1}},N=async(e,t)=>{if(!o.value||!t.length)return!1;try{const a=await $fetch("/api/v1/notifications/bulk-action",{method:"POST",baseURL:s.public.apiBase,headers:c(),body:{action:e,notification_ids:t},timeout:1e4});return t.forEach(d=>{const i=r.value.find(u=>u.id===d);if(i)switch(e){case"mark_read":i.read_at||(i.read_at=new Date().toISOString(),n.value=Math.max(0,n.value-1));break;case"mark_unread":i.read_at&&(i.read_at=null,n.value+=1);break;case"delete":const u=r.value.findIndex(h=>h.id===d);u!==-1&&(i.read_at||(n.value=Math.max(0,n.value-1)),r.value.splice(u,1));break}}),a}catch(a){return console.error("Failed to perform bulk action:",a),!1}},L=async e=>{if(!o.value)return null;try{const t=await $fetch("/api/v1/notifications",{method:"POST",baseURL:s.public.apiBase,headers:c(),body:e,timeout:5e3});return r.value.unshift(t.notification),t.notification.read_at||(n.value+=1),t.notification}catch(t){return console.error("Failed to create notification:",t),null}},x=e=>{var t,a;return((t=e.metadata)==null?void 0:t.icon)||((a=e.getIcon)==null?void 0:a.call(e))||"bell"},A=e=>{var t,a;return((t=e.data)==null?void 0:t.title)||((a=e.getTitle)==null?void 0:a.call(e))||"Notification"},S=e=>{var t,a;return((t=e.data)==null?void 0:t.message)||((a=e.getMessage)==null?void 0:a.call(e))||""},D=e=>{var t,a;return((t=e.metadata)==null?void 0:t.action_url)||((a=e.getActionUrl)==null?void 0:a.call(e))||null},M=e=>!e.read_at,T=e=>{const t=e.priority||"normal";return{low:"text-gray-600",normal:"text-blue-600",high:"text-orange-600",urgent:"text-red-600"}[t]||"text-blue-600"},B=e=>{if(!e.created_at)return"";const t=new Date(e.created_at),d=new Date().getTime()-t.getTime(),i=Math.floor(d/6e4),u=Math.floor(i/60),h=Math.floor(u/24);return i<1?"Just now":i<60?`${i}m ago`:u<24?`${u}h ago`:h<7?`${h}d ago`:t.toLocaleDateString()};let l=null;const F=(e=6e4)=>{l&&clearInterval(l),l=J(()=>{o.value&&b()},e)},_=()=>{l&&(clearInterval(l),l=null)},O=m(()=>n.value>0),P=m(()=>r.value.filter(e=>!e.read_at)),C=m(()=>r.value.filter(e=>e.read_at)),I=()=>{f.value=!f.value,f.value&&y()},E=()=>{f.value=!1};return H(()=>{_()}),{notifications:p(r),unreadCount:p(n),isLoading:p(g),isDropdownOpen:p(f),hasUnreadNotifications:O,unreadNotifications:P,readNotifications:C,fetchNotifications:w,fetchRecentNotifications:y,fetchUnreadCount:b,markAsRead:R,markAsUnread:$,markAllAsRead:U,deleteNotification:k,bulkAction:N,createNotification:L,toggleDropdown:I,closeDropdown:E,getNotificationIcon:x,getNotificationTitle:A,getNotificationMessage:S,getNotificationActionUrl:D,isNotificationUnread:M,getNotificationPriorityClass:T,formatNotificationTime:B,startAutoRefresh:F,stopAutoRefresh:_}};export{G as u};
